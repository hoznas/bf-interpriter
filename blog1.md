# 言語処理系を自作しよう！（第１回　簡単BF編）
プログラマたるもの、身の回りのソフトウェアを自分で作りたいと思ったことありますよね？
プログラミングを覚えてすぐに、blogやtodoリスト、テキストエディタやブラウザなどを
作ろうとして挫折したりなんてこと、１度や２度では無いですよね。
ええ、きっとあるはずです。プログラマというものはそういうものです。
## プログラミング言語を自作することに何のメリットが？？
プログラミング言語に対する深い理解が生まれます。
プログラミング言語を自作するのは、それなりに大変な作業ですが、
その分、成し遂げた達成感はかなりのものです。
今後のプログラミング生活に大きなプラスをもたらします。
大丈夫です。簡単なものからちょっとずつ複雑な言語にステップアップしていきましょう。

## 今回のテーマ「BrainF*ck」
BrainF*ckとは、以下のような特徴があり、言語処理系を初めて作るのに最適なプログラミング言語です。（名前がよろしく無いので、ここからはBFと表記しますね。）
- いわゆる「難解言語」の一つで、読みににくく、書きにくいです。実用性もありません。
- 命令が8個(8文字)しかなく、言語処理系が小さくなるように設計されています。
- 計算機理論の「チューリングマシン」を忠実に再現した計算モデルです。
- Hello, world!を出力するプログラムは以下のとおりです。（コードは英語版のwikipediaから拝借）
```BrainFuck
++++++++[>++++[>++>+++>+++>+<<<<-]>+>+>->>+[<]<-]>>.>---.+++++++..+++.>>.<-.<.+++.------.--------.>>+.>++.
```

### BFの詳しい説明
詳しい説明は、以下のサイトに譲ります。（文章量が多くなると私が大変なので、スミマセン！）
- https://ja.wikipedia.org/wiki/Brainfuck
- http://www.kmonos.net/alang/etc/brainfuck.php

## まずは簡単なインタプリタを作ってみよう
まず最初にお断りしますが、このコーナーは主にTypescriptを使って書きます。
理由は私がメインで使っていて馴染みがあるためです。
Typescript固有の機能は避けて書こうと思いますので、よろしくお願いいたします。

さて、BFは極度に書き方がシンプルなので、以下の表のようにJavascriptのコードに対応できます。
（「Typescriptで書きます」とか言って、いきなりJavascriptが出てきてすみません！
Typescript読めるなら、Javascriptは余裕ですよね？？）

### BFプログラムとJavascriptの対応表
|BFの命令|意味| Javascriptの対応するコード|
|-------|---|----------------|
|>|ポインタを左に移動する|pointer++;|
|<|ポインタを左に移動する|pointer--;|
|+|ポインタが指し示すメモリセルを1増やす|memory\[pointer\]++;|
|-|ポインタが指し示すメモリセルを1減らす|memory\[pointer\]--;|
|\[|ポインタが指し示すメモリセルが0でない間、対応する"\]"までの命令を繰り返す|while(memory\[pointer]!==0){|
|\]|上記のとおり|}|
|.|ポインタが指し示すメモリセルに対応する文字コードを出力する|console.log(String.fromCharCode(memory\[pointer\]));|
|,|ポインタが指し示すメモリセルに１文字入力する| **ここは宿題にします**|

### プログラム例
```typescript
// 文字をBFのプログラムに変換する関数
function translate(ch: string): string {
  switch (ch) {
    case '>':
      return 'pointer++;';
    case '<':
      return 'pointer--;';
    case '+':
      return 'memory[pointer]++;';
    case '-':
      return 'memory[pointer]--;';
    case '[':
      return 'while(memory[pointer]!==0){';
    case ']':
      return '}';
    case '.':
      return 'console.log(String.fromCharCode(memory[pointer]));';
    case ',':
      return '/*宿題です*/';
    default:
      // 上記８文字以外は無視する。
      return '';
  }
}

// "Hello, World."を出力するBFのコード
const bfCode =
  '++++++++++[->+++++++<]>++.>++++++++++[->++++++++++<]>+.<+++[->++<]>+..+++.<<<++++[->-------<]>.<+++[->----<]>.>++[->++++<]>.<++[->----<]>.+++.<++[->---<]>.<++[->----<]>.<<+.';

// pointerとmemoryを初期化
const header = 'pointer=0;memory=[0,0,0,0,0,0,0,0,0,0];';

// BFのコードを、1文字ごとに分解し、Javascriptに変換
const body = bfCode.split('').map(translate).join('');

const program = header + body;

// Javascriptのコードとして実行
eval(program);
```

### 実行結果
```
Hello, world!
```
これで一つのプログラミング言語の言語処理系を作ることができましたね！
これだけでもチューリング等価という、全てのプログラミング言語が持つ「理論上、全ての計算ができたりできなかったりする能力」を得たことになります。

## 発展問題（宿題）
","の「一文字入力を受け取り、memory[pointer]に入れる処理」をまだ作っていません。
と、いうのも、Typescriptでは標準入力を受け取ることはあまり一般的ではありません。
説明を簡単にするため、思い切って省略してしまいました。
余力があったら作ってみて下さい。

## 次回
次回の言語もBFとします。
BFをもうちょっと丁寧な実装にチャレンジしてみます。
